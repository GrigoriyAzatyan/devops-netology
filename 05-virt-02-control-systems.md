# Задача 1  
Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

* **100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований** - KVM или Xen как бесплатные универсальные варианты, или VMware vSphere, если есть деньги.

* **Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий** - Hyper-V максимально поддерживает ОС Windows, содержит возможности балансировки, репликации. Резервные копии делаются с помощью Windows Server Backup, PowerShell-скриптов или сторонних решений (Acronis/VEEAM и др.). Для максимальной гибкости управления при большой нагрузке потребуется покупка Virtual Machine Manager.

* **Требуется наиболее производительное бесплатное opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин** - Xen HVM как бесплатный и стабильный продукт для поддержки разнорродных гостевых ОС, работающий в режиме полной виртуализации.

* **Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры** - Hyper-V максимально поддерживает Windows, но условно "бесплатен" в случае, если хост работает с уже купленной и активированной Windows Server: один пакет лицензий Windows Server Standard (кол-во рассчитывается по ядрам CPU, приобретается не менее 16) позволяет установить Windows на 1 хост и 2 виртуальные машины, такая же лицензия Windows Server Datacenter позволяет активировать Windows на 1 хосте и неограниченном числе виртуальных машин. Для полной бесплатности подойдет Xen.

* **Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux** - для тестирования подойдет VirtualBox, либо облачные провайдеры. Причина: наиболее быстрый доступ к инфраструктуре, все "под рукой" (на личном ПК или в облаке), нет особых требований к балансировке, репликации виртуальных машин и т.д.


# Задача 2
Опишите сценарий миграции с VMware vSphere на Hyper-V для Linux и Windows виртуальных машин. Детально опишите необходимые шаги для использования всех преимуществ Hyper-V для Windows.

**Ответы:**  

Вариант 1. Если есть Virtual Machine Manager, то в нем есть готовый мастер, а также PowerShell-скрипты: https://docs.microsoft.com/ru-ru/system-center/vmm/vm-convert-vmware?view=sc-vmm-2019. Получается готовая виртуальная машина в формате Hyper-V поколения 2.  

Вариант 2. С помощью бесплатной утилиты StarWind V2V Converter: https://www.starwindsoftware.com/starwind-v2v-converter:  
- Конвертируем виртуальный диск из VMDK в VHDX;
- по окончании конвертации вручную создаем в Hyper-V новую ВМ, выделяем ей необходимые ресурсы и подключаем сконвертированный диск.

**В обоих случаях** также потребуется:
- предварительно удалить из гостевой системы VMware Tools;
- скорее всего, после включения машины, в готсевой ОС потребуется обновить драйверы и перенастроить сетевые адаптеры. 
- Также со 100% вероятностью слетят программные лицензии, привязанные к компьютеру - например, 1С (при наличии таковых). Их придется переактивировать.

Что касается "использования всех преимуществ Hyper-V для Windows", то как правило, следует:  
- не устанавливать на хост посторонние приложения и роли, которые будут отнимать производительность у виртуальных машин и потенциально мешать работе гипервизора. Наихудший и вполне реальный пример: на одной физической машине роль Hyper-V с работающими ВМ + контроллер домена + файловый сервер + сервер 1С + SQL сервер + сервер терминалов + антивирус Касперского в одном флаконе;  
- включить аппаратную виртуализацию в BIOS  (VT-x, EPT, AMD-V) и режим электропитания - OS Controlled mode;  
- на хостовой машине исключить из проверки антивирусом каталоги виртуальных машин;
- там, где требуется повышенная производительность, использовать фиксированные виртуальные диски вместо динамически расширяемых;
- при особых требованиях к скорости диска (базы данных) подключать к виртуальной машине физические накопители вместо виртуальных;
- отказаться от использования снапшотов. Снапшоты снижают производительность диска: https://qastack.ru/server/430138/why-vm-snapshots-are-affecting-performance

# Задача 3
Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был бы выбор, то создавали ли вы бы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.  

**Ответы:**  
* Проблемы и недостатки:  
1. Доступ к инфраструктуре не в "режиме одного окна" - понижается удобство управления;
2. Повышенные требования к инженеру: требуется умение работать и решать проблемы в каждой среде виртуализации;
3. Сложности с миграцией виртуальных машин их одной среды в другую.

* Для минимизации проблем нужно либо уметь поддерживать все эти инфраструктуры, а также найти способ решить задачи по миграции виртуальных машин в случае, когда это понадобится - либо постараться перейти к однородной инфраструктуре.

* Если бизнес-задача требует повышенной надежности (часть ресурсов локально, часть в облаке) - то без гетерогенной среды не обойтись. Надо освоиться в обеих средах и выработать практику работы с ними. Сама по себе гетерогенная среда "ради самой себя" или потому что "так сложилось" - это скорее проблема, от которой надо уйти.

